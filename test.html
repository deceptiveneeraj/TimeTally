<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Manager</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #f39c12;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --dark-color: #2c3e50;
            --light-bg: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 20px;
        }

        .container-wrapper {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 30px rgba(0,0,0,0.2);
        }

        .navbar-custom {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-custom .menu-icon, .navbar-custom .add-icon {
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .navbar-custom .menu-icon:hover, .navbar-custom .add-icon:hover {
            transform: scale(1.1);
        }

        .navbar-custom .title {
            font-size: 20px;
            font-weight: 600;
            flex: 1;
            text-align: center;
        }

        .subject-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .subject-name {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .percentage-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 14px;
            color: white;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: var(--light-bg);
            margin: 15px;
            border-radius: 10px;
        }

        .calendar-nav {
            cursor: pointer;
            padding: 5px 15px;
            background: var(--primary-color);
            color: white;
            border-radius: 5px;
            transition: background 0.3s;
        }

        .calendar-nav:hover {
            background: #357abd;
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            padding: 10px 15px;
            font-weight: 600;
            color: var(--dark-color);
            text-align: center;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            padding: 0 15px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-weight: 500;
            font-size: 14px;
        }

        .calendar-day:hover {
            background: var(--light-bg);
        }

        .calendar-day.today {
            border: 2px solid var(--primary-color);
        }

        .calendar-day.present {
            background: var(--success-color);
            color: white;
        }

        .calendar-day.absent {
            background: var(--danger-color);
            color: white;
        }

        .calendar-day.halfday {
            background: var(--secondary-color);
            color: white;
        }

        .calendar-day.holiday {
            background: #9b59b6;
            color: white;
        }

        .calendar-day.weekoff {
            background: #34495e;
            color: white;
        }

        .calendar-day.leave {
            background: #e67e22;
            color: white;
        }

        .shift-badge {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 8px;
            background: rgba(0,0,0,0.3);
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
        }

        .footer-stats {
            background: white;
            padding: 20px;
            margin: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
        }

        .stat-row:last-child {
            border-bottom: none;
        }

        .stat-label {
            font-weight: 600;
            color: var(--dark-color);
        }

        .stat-value {
            color: var(--primary-color);
            font-weight: 600;
        }

        .modal-content {
            border-radius: 20px;
            border: none;
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 20px 20px 0 0;
        }

        .btn-custom {
            border-radius: 10px;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .attendance-option {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid #ecf0f1;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .attendance-option:hover {
            border-color: var(--primary-color);
            background: var(--light-bg);
        }

        .attendance-option i {
            font-size: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #95a5a6;
        }

        .empty-state i {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .more-info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .info-card {
            background: var(--light-bg);
            padding: 10px;
            border-radius: 8px;
            text-align: center;
        }

        .info-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .back-button {
            cursor: pointer;
            font-size: 24px;
            color: white;
        }

        .submenu-option {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #ecf0f1;
        }

        .submenu-option:hover {
            background: var(--light-bg);
        }

        .submenu-option:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container-wrapper">
        <!-- Home Page -->
        <div id="homePage">
            <div class="navbar-custom">
                <i class="fas fa-bars menu-icon"></i>
                <div class="title">Attendance Manager</div>
                <i class="fas fa-plus add-icon" onclick="showAddSubjectModal()"></i>
            </div>
            <div id="subjectsList">
                <div class="empty-state">
                    <i class="fas fa-calendar-check"></i>
                    <h4>No Subjects Added</h4>
                    <p>Click the + button to add your first subject or work</p>
                </div>
            </div>
        </div>

        <!-- Detail Page -->
        <div id="detailPage" style="display: none;">
            <div class="navbar-custom">
                <i class="fas fa-arrow-left back-button" onclick="goBack()"></i>
                <div class="title" id="detailTitle"></div>
                <i class="fas fa-ellipsis-v" style="cursor: pointer;" onclick="showOptionsMenu()"></i>
            </div>
            
            <div class="calendar-header">
                <div class="calendar-nav" onclick="changeMonth(-1)">Prev</div>
                <div id="currentMonth" style="font-weight: 600; font-size: 16px;"></div>
                <div class="calendar-nav" onclick="changeMonth(1)">Next</div>
            </div>

            <div class="weekdays">
                <div>SUN</div>
                <div>MON</div>
                <div>TUE</div>
                <div>WED</div>
                <div>THU</div>
                <div>FRI</div>
                <div>SAT</div>
            </div>

            <div class="calendar-days" id="calendarDays"></div>

            <div class="footer-stats">
                <div class="stat-row">
                    <span class="stat-label">Present</span>
                    <span class="stat-value" id="presentCount">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Absent</span>
                    <span class="stat-value" id="absentCount">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Half Days</span>
                    <span class="stat-value" id="halfDayCount">0</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">OT</span>
                    <span class="stat-value" id="otCount">0 hrs - 0 days</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Total Percentage</span>
                    <span class="stat-value" id="totalPercentage">0%</span>
                </div>
                <div style="margin-top: 15px;">
                    <button class="btn btn-primary w-100 btn-custom" onclick="showMoreInfo()">More Info</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Subject Modal -->
    <div class="modal fade" id="addSubjectModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Subject or Work</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="text" class="form-control" id="subjectInput" placeholder="Math, Job Name, Company Name, etc.">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-custom" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-primary btn-custom" onclick="addSubject()">
                        <i class="fas fa-plus"></i> ADD
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Modal -->
    <div class="modal fade" id="attendanceModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Mark Attendance</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="attendance-option" onclick="markAttendance('present')">
                        <i class="fas fa-check-circle" style="color: var(--success-color);"></i>
                        <span>Present</span>
                    </div>
                    <div class="attendance-option" onclick="markAttendance('absent')">
                        <i class="fas fa-times-circle" style="color: var(--danger-color);"></i>
                        <span>Absent</span>
                    </div>
                    <div class="attendance-option" onclick="markAttendance('halfday')">
                        <i class="fas fa-adjust" style="color: var(--secondary-color);"></i>
                        <span>Half Day</span>
                    </div>
                    <div class="attendance-option" onclick="showOvertimeInput()">
                        <i class="fas fa-clock" style="color: #3498db;"></i>
                        <span>Over Time</span>
                    </div>
                    <div class="attendance-option" onclick="showShiftMenu()">
                        <i class="fas fa-business-time" style="color: #16a085;"></i>
                        <span>Shift</span>
                    </div>
                    <div class="attendance-option" onclick="showMoreOptions()">
                        <i class="fas fa-ellipsis-h" style="color: #95a5a6;"></i>
                        <span>More Options</span>
                    </div>
                    <div class="attendance-option" onclick="clearAttendance()">
                        <i class="fas fa-eraser" style="color: #e74c3c;"></i>
                        <span>Clear</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shift Menu Modal -->
    <div class="modal fade" id="shiftModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Select Shift</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="attendance-option" onclick="setShift('M')">
                        <i class="fas fa-sun"></i>
                        <span>Morning</span>
                    </div>
                    <div class="attendance-option" onclick="setShift('A')">
                        <i class="fas fa-cloud-sun"></i>
                        <span>Afternoon</span>
                    </div>
                    <div class="attendance-option" onclick="setShift('N')">
                        <i class="fas fa-moon"></i>
                        <span>Night</span>
                    </div>
                    <div class="attendance-option" onclick="setShift('G')">
                        <i class="fas fa-briefcase"></i>
                        <span>General</span>
                    </div>
                    <div class="attendance-option" onclick="setShift('')">
                        <i class="fas fa-times"></i>
                        <span>Clear Shift</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- More Options Modal -->
    <div class="modal fade" id="moreOptionsModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">More Options</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="attendance-option" onclick="markAttendance('holiday')">
                        <i class="fas fa-umbrella-beach" style="color: #9b59b6;"></i>
                        <span>Holiday</span>
                    </div>
                    <div class="attendance-option" onclick="markAttendance('weekoff')">
                        <i class="fas fa-calendar-times" style="color: #34495e;"></i>
                        <span>Week Off</span>
                    </div>
                    <div class="attendance-option" onclick="showLeaveMenu()">
                        <i class="fas fa-file-medical" style="color: #e67e22;"></i>
                        <span>Leave</span>
                    </div>
                    <div class="attendance-option" onclick="addNote()">
                        <i class="fas fa-sticky-note" style="color: #f39c12;"></i>
                        <span>Add Note</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Leave Menu Modal -->
    <div class="modal fade" id="leaveModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Select Leave Type</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="attendance-option" onclick="markLeave('privileged')">
                        <i class="fas fa-star"></i>
                        <span>Privileged Leave</span>
                    </div>
                    <div class="attendance-option" onclick="markLeave('casual')">
                        <i class="fas fa-coffee"></i>
                        <span>Casual Leave</span>
                    </div>
                    <div class="attendance-option" onclick="markLeave('sick')">
                        <i class="fas fa-thermometer"></i>
                        <span>Sick Leave</span>
                    </div>
                    <div class="attendance-option" onclick="markLeave('other')">
                        <i class="fas fa-ellipsis-h"></i>
                        <span>Other Leave</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Options Menu Modal -->
    <div class="modal fade" id="optionsMenuModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Options</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="submenu-option" onclick="searchAttendance()">
                        <i class="fas fa-search"></i> Search Attendance
                    </div>
                    <div class="submenu-option" onclick="calculateSalary()">
                        <i class="fas fa-calculator"></i> Calculate Salary
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- More Info Modal -->
    <div class="modal fade" id="moreInfoModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Detailed Information</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="more-info-grid">
                        <div class="info-card">
                            <div class="info-label">Holidays</div>
                            <div class="info-value" id="infoHolidays">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Week Offs</div>
                            <div class="info-value" id="infoWeekOffs">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Privileged Leave</div>
                            <div class="info-value" id="infoPrivileged">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Casual Leave</div>
                            <div class="info-value" id="infoCasual">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Sick Leave</div>
                            <div class="info-value" id="infoSick">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Other Leave</div>
                            <div class="info-value" id="infoOther">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Morning Shift</div>
                            <div class="info-value" id="infoMorning">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Afternoon Shift</div>
                            <div class="info-value" id="infoAfternoon">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">Night Shift</div>
                            <div class="info-value" id="infoNight">0</div>
                        </div>
                        <div class="info-card">
                            <div class="info-label">General Shift</div>
                            <div class="info-value" id="infoGeneral">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
    <script>
        let subjects = [];
        let currentSubject = null;
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();
        let selectedDate = null;
        let attendanceData = {};

        function showAddSubjectModal() {
            const modal = new bootstrap.Modal(document.getElementById('addSubjectModal'));
            modal.show();
        }

        function addSubject() {
            const input = document.getElementById('subjectInput');
            const name = input.value.trim();
            if (name) {
                subjects.push({ name, id: Date.now() });
                input.value = '';
                bootstrap.Modal.getInstance(document.getElementById('addSubjectModal')).hide();
                renderSubjects();
            }
        }

        function renderSubjects() {
            const list = document.getElementById('subjectsList');
            if (subjects.length === 0) {
                list.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-calendar-check"></i>
                        <h4>No Subjects Added</h4>
                        <p>Click the + button to add your first subject or work</p>
                    </div>
                `;
            } else {
                list.innerHTML = subjects.map(s => {
                    const percentage = calculatePercentage(s.id);
                    const color = percentage >= 75 ? 'var(--success-color)' : percentage >= 50 ? 'var(--secondary-color)' : 'var(--danger-color)';
                    return `
                        <div class="subject-card" onclick="openSubject(${s.id})">
                            <div class="subject-name">${s.name}</div>
                            <div class="percentage-circle" style="background: ${color}">
                                ${percentage}%
                            </div>
                        </div>
                    `;
                }).join('');
            }
        }

        function calculatePercentage(subjectId) {
            const data = attendanceData[subjectId] || {};
            const monthKey = `${currentYear}-${currentMonth}`;
            const monthData = data[monthKey] || {};
            
            let present = 0, total = 0;
            Object.values(monthData).forEach(day => {
                if (day.status && day.status !== 'holiday' && day.status !== 'weekoff') {
                    total++;
                    if (day.status === 'present') present++;
                    if (day.status === 'halfday') present += 0.5;
                }
            });
            
            return total > 0 ? Math.round((present / total) * 100) : 0;
        }

        function openSubject(id) {
            currentSubject = subjects.find(s => s.id === id);
            document.getElementById('detailTitle').textContent = currentSubject.name;
            document.getElementById('homePage').style.display = 'none';
            document.getElementById('detailPage').style.display = 'block';
            renderCalendar();
            updateStats();
        }

        function goBack() {
            document.getElementById('homePage').style.display = 'block';
            document.getElementById('detailPage').style.display = 'none';
            renderSubjects();
        }

        function changeMonth(delta) {
            currentMonth += delta;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderCalendar();
            updateStats();
        }

        function renderCalendar() {
            const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
            document.getElementById('currentMonth').textContent = `${months[currentMonth]} ${currentYear}`;
            
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            const container = document.getElementById('calendarDays');
            container.innerHTML = '';
            
            for (let i = 0; i < firstDay; i++) {
                container.appendChild(document.createElement('div'));
            }
            
            const today = new Date();
            const data = attendanceData[currentSubject.id] || {};
            const monthKey = `${currentYear}-${currentMonth}`;
            const monthData = data[monthKey] || {};
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day';
                dayEl.textContent = day;
                
                if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dayEl.classList.add('today');
                }
                
                const dayData = monthData[day] || {};
                if (dayData.status) {
                    dayEl.classList.add(dayData.status);
                }
                
                if (dayData.shift) {
                    const badge = document.createElement('span');
                    badge.className = 'shift-badge';
                    badge.textContent = dayData.shift;
                    dayEl.appendChild(badge);
                }
                
                dayEl.onclick = () => showAttendanceModal(day);
                container.appendChild(dayEl);
            }
        }

        function showAttendanceModal(day) {
            selectedDate = day;
            const modal = new bootstrap.Modal(document.getElementById('attendanceModal'));
            modal.show();
        }

        function markAttendance(status) {
            if (!attendanceData[currentSubject.id]) {
                attendanceData[currentSubject.id] = {};
            }
            const monthKey = `${currentYear}-${currentMonth}`;
            if (!attendanceData[currentSubject.id][monthKey]) {
                attendanceData[currentSubject.id][monthKey] = {};
            }
            if (!attendanceData[currentSubject.id][monthKey][selectedDate]) {
                attendanceData[currentSubject.id][monthKey][selectedDate] = {};
            }
            
            attendanceData[currentSubject.id][monthKey][selectedDate].status = status;
            
            bootstrap.Modal.getInstance(document.getElementById('attendanceModal')).hide();
            renderCalendar();
            updateStats();
        }

        function showOvertimeInput() {
            const hours = prompt("Enter overtime hours:");
            if (hours !== null && !isNaN(hours) && hours >= 0) {
                if (!attendanceData[currentSubject.id]) {
                    attendanceData[currentSubject.id] = {};
                }
                const monthKey = `${currentYear}-${currentMonth}`;
                if (!attendanceData[currentSubject.id][monthKey]) {
                    attendanceData[currentSubject.id][monthKey] = {};
                }
                if (!attendanceData[currentSubject.id][monthKey][selectedDate]) {
                    attendanceData[currentSubject.id][monthKey][selectedDate] = {};
                }
                
                attendanceData[currentSubject.id][monthKey][selectedDate].overtime = parseFloat(hours);
                bootstrap.Modal.getInstance(document.getElementById('attendanceModal')).hide();
                renderCalendar();
                updateStats();
            }
        }

        function showShiftMenu() {
            bootstrap.Modal.getInstance(document.getElementById('attendanceModal')).hide();
            const modal = new bootstrap.Modal(document.getElementById('shiftModal'));
            modal.show();
        }

        function setShift(shift) {
            if (!attendanceData[currentSubject.id]) {
                attendanceData[currentSubject.id] = {};
            }
            const monthKey = `${currentYear}-${currentMonth}`;
            if (!attendanceData[currentSubject.id][monthKey]) {
                attendanceData[currentSubject.id][monthKey] = {};
            }
            if (!attendanceData[currentSubject.id][monthKey][selectedDate]) {
                attendanceData[currentSubject.id][monthKey][selectedDate] = {};
            }
            
            attendanceData[currentSubject.id][monthKey][selectedDate].shift = shift;
            bootstrap.Modal.getInstance(document.getElementById('shiftModal')).hide();
            renderCalendar();
            updateStats();
        }

        function showMoreOptions() {
            bootstrap.Modal.getInstance(document.getElementById('attendanceModal')).hide();
            const modal = new bootstrap.Modal(document.getElementById('moreOptionsModal'));
            modal.show();
        }

        function showLeaveMenu() {
            bootstrap.Modal.getInstance(document.getElementById('moreOptionsModal')).hide();
            const modal = new bootstrap.Modal(document.getElementById('leaveModal'));
            modal.show();
        }

        function markLeave(leaveType) {
            if (!attendanceData[currentSubject.id]) {
                attendanceData[currentSubject.id] = {};
            }
            const monthKey = `${currentYear}-${currentMonth}`;
            if (!attendanceData[currentSubject.id][monthKey]) {
                attendanceData[currentSubject.id][monthKey] = {};
            }
            if (!attendanceData[currentSubject.id][monthKey][selectedDate]) {
                attendanceData[currentSubject.id][monthKey][selectedDate] = {};
            }
            
            attendanceData[currentSubject.id][monthKey][selectedDate].status = 'leave';
            attendanceData[currentSubject.id][monthKey][selectedDate].leaveType = leaveType;
            
            bootstrap.Modal.getInstance(document.getElementById('leaveModal')).hide();
            renderCalendar();
            updateStats();
        }

        function addNote() {
            const note = prompt("Enter note:");
            if (note !== null) {
                if (!attendanceData[currentSubject.id]) {
                    attendanceData[currentSubject.id] = {};
                }
                const monthKey = `${currentYear}-${currentMonth}`;
                if (!attendanceData[currentSubject.id][monthKey]) {
                    attendanceData[currentSubject.id][monthKey] = {};
                }
                if (!attendanceData[currentSubject.id][monthKey][selectedDate]) {
                    attendanceData[currentSubject.id][monthKey][selectedDate] = {};
                }
                
                attendanceData[currentSubject.id][monthKey][selectedDate].note = note;
                bootstrap.Modal.getInstance(document.getElementById('moreOptionsModal')).hide();
                alert("Note added successfully!");
            }
        }

        function clearAttendance() {
            if (!attendanceData[currentSubject.id]) return;
            
            const monthKey = `${currentYear}-${currentMonth}`;
            if (attendanceData[currentSubject.id][monthKey] && attendanceData[currentSubject.id][monthKey][selectedDate]) {
                delete attendanceData[currentSubject.id][monthKey][selectedDate];
            }
            
            bootstrap.Modal.getInstance(document.getElementById('attendanceModal')).hide();
            renderCalendar();
            updateStats();
        }

        function updateStats() {
            if (!currentSubject) return;
            
            const data = attendanceData[currentSubject.id] || {};
            const monthKey = `${currentYear}-${currentMonth}`;
            const monthData = data[monthKey] || {};
            
            let present = 0, absent = 0, halfday = 0, overtime = 0;
            let holidays = 0, weekoffs = 0;
            let privileged = 0, casual = 0, sick = 0, other = 0;
            let morning = 0, afternoon = 0, night = 0, general = 0;
            
            Object.values(monthData).forEach(day => {
                if (day.status) {
                    switch(day.status) {
                        case 'present': present++; break;
                        case 'absent': absent++; break;
                        case 'halfday': halfday++; break;
                        case 'holiday': holidays++; break;
                        case 'weekoff': weekoffs++; break;
                        case 'leave': 
                            switch(day.leaveType) {
                                case 'privileged': privileged++; break;
                                case 'casual': casual++; break;
                                case 'sick': sick++; break;
                                case 'other': other++; break;
                            }
                            break;
                    }
                }
                
                if (day.overtime) {
                    overtime += day.overtime;
                }
                
                if (day.shift) {
                    switch(day.shift) {
                        case 'M': morning++; break;
                        case 'A': afternoon++; break;
                        case 'N': night++; break;
                        case 'G': general++; break;
                    }
                }
            });
            
            document.getElementById('presentCount').textContent = present;
            document.getElementById('absentCount').textContent = absent;
            document.getElementById('halfDayCount').textContent = halfday;
            
            const overtimeDays = Math.floor(overtime / 8);
            const remainingHours = overtime % 8;
            document.getElementById('otCount').textContent = `${overtime} hrs - ${overtimeDays} days`;
            
            const totalDays = present + absent + halfday;
            const percentage = totalDays > 0 ? Math.round((present + (halfday * 0.5)) / totalDays * 100) : 0;
            document.getElementById('totalPercentage').textContent = `${percentage}%`;
            
            // Update more info modal data
            document.getElementById('infoHolidays').textContent = holidays;
            document.getElementById('infoWeekOffs').textContent = weekoffs;
            document.getElementById('infoPrivileged').textContent = privileged;
            document.getElementById('infoCasual').textContent = casual;
            document.getElementById('infoSick').textContent = sick;
            document.getElementById('infoOther').textContent = other;
            document.getElementById('infoMorning').textContent = morning;
            document.getElementById('infoAfternoon').textContent = afternoon;
            document.getElementById('infoNight').textContent = night;
            document.getElementById('infoGeneral').textContent = general;
        }

        function showMoreInfo() {
            updateStats(); // Ensure data is up to date
            const modal = new bootstrap.Modal(document.getElementById('moreInfoModal'));
            modal.show();
        }

        function showOptionsMenu() {
            const modal = new bootstrap.Modal(document.getElementById('optionsMenuModal'));
            modal.show();
        }

        function searchAttendance() {
            const searchTerm = prompt("Enter date (DD-MM-YYYY) or status to search:");
            if (searchTerm) {
                alert(`Search functionality for "${searchTerm}" would be implemented here.`);
            }
        }

        function calculateSalary() {
            alert("Salary calculation feature would be implemented here with rate per day input.");
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            renderSubjects();
            
            // Load data from localStorage if available
            const savedData = localStorage.getItem('attendanceData');
            if (savedData) {
                attendanceData = JSON.parse(savedData);
            }
            
            const savedSubjects = localStorage.getItem('subjects');
            if (savedSubjects) {
                subjects = JSON.parse(savedSubjects);
                renderSubjects();
            }
        });

        // Save data to localStorage when changes occur
        function saveData() {
            localStorage.setItem('attendanceData', JSON.stringify(attendanceData));
            localStorage.setItem('subjects', JSON.stringify(subjects));
        }

        // Override functions to include saveData
        const originalAddSubject = addSubject;
        addSubject = function() {
            originalAddSubject();
            saveData();
        };

        const originalMarkAttendance = markAttendance;
        markAttendance = function(status) {
            originalMarkAttendance(status);
            saveData();
        };

        const originalSetShift = setShift;
        setShift = function(shift) {
            originalSetShift(shift);
            saveData();
        };

        const originalMarkLeave = markLeave;
        markLeave = function(leaveType) {
            originalMarkLeave(leaveType);
            saveData();
        };

        const originalClearAttendance = clearAttendance;
        clearAttendance = function() {
            originalClearAttendance();
            saveData();
        };
    </script>
</body>
</html>